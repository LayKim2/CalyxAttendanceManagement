@attribute [Authorize]
@inject IPTOService PTOService
@implements IDisposable

<RadzenDataGrid AllowFiltering="true" AllowColumnResize="false" AllowAlternatingRows="false" FilterMode="FilterMode.Advanced" AllowSorting="true" PageSize="10" AllowPaging="true" PagerHorizontalAlign="HorizontalAlign.Left" ShowPagingSummary="true"
                Data="@PTOService.UserPTOHistories" TItem="UserPTOHistory" ColumnWidth="300px" LogicalFilterOperator="LogicalFilterOperator.Or">
    <Columns>
        <RadzenDataGridColumn TItem="UserPTOHistory" Property="Id" Filterable="false" Title="ID" Frozen="true" Width="50px" TextAlign="TextAlign.Center" />
        <RadzenDataGridColumn TItem="UserPTOHistory" Property="" Title="Date" Frozen="true" Sortable="true" Filterable="false" Width="200px" TextAlign="TextAlign.Center">
            <Template Context="userPTOHistory">
                <RadzenText TextStyle="TextStyle.Subtitle2" class="mb-0">
                    @if(userPTOHistory.PTOType == "1일 이상")
                    {
                        @userPTOHistory.StartDate.Value.ToString("MM/dd/yyyy") <br/> @userPTOHistory.EndDate.Value.ToString("MM/dd/yyyy")
                    } else
                    {
                        @userPTOHistory.StartDate.Value.ToString("MM/dd/yyyy")
                    }

                </RadzenText>
            </Template>
        </RadzenDataGridColumn>
        <RadzenDataGridColumn TItem="UserPTOHistory" Property="StartDate" Title="Start Date" FormatString="{0:d}" Width="140px" />
        <RadzenDataGridColumn TItem="UserPTOHistory" Property="EndDate" Title="End Date" FormatString="{0:d}" Width="140px" />
        <RadzenDataGridColumn TItem="UserPTOHistory" Property="PTOType" Title="PTO Type" Frozen="true" Width="100px" />
        <RadzenDataGridColumn TItem="UserPTOHistory" Property="NeedPTO" Title="필요한 PTO" Frozen="true" Width="100px" />
        <RadzenDataGridColumn TItem="UserPTOHistory" Property="CurrentPTO" Title="현재 PTO" Frozen="true" Width="100px" />
        <RadzenDataGridColumn TItem="UserPTOHistory" Property="CalculatedPTO" Title="남은 PTO" Frozen="true" Width="100px" />
        <RadzenDataGridColumn TItem="UserPTOHistory" Property="Comment" Title="Comment" Frozen="true" Width="160px" />
        <RadzenDataGridColumn TItem="UserPTOHistory" Property="VerifiedType" Title="Result" Width="120px" />
    </Columns>
</RadzenDataGrid>


@code {

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();

        await PTOService.GetUserPTOHistories();

        PTOService.OnChange += StateHasChanged;
    }

    public void Dispose()
    {
        PTOService.OnChange -= StateHasChanged;
    }
}
